<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة الأغاني - Golden Vibes</title>
  
  <!-- الخطوط والأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    * {
      font-family: 'Tajawal', sans-serif;
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    
    .neumorphic {
      box-shadow: 12px 12px 24px #d1d5db, 
                  -12px -12px 24px #ffffff;
    }
    
    .song-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .song-card:hover {
      transform: translateY(-2px);
    }
  </style>
</head>

<body class="bg-gradient-to-br from-amber-50 to-amber-100 min-h-screen p-4 md:p-6">
  <div class="max-w-2xl mx-auto">
    <!-- قسم الإضافة -->
    <div class="glass-effect neumorphic rounded-xl p-6 mb-8">
      <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center text-amber-700">
        <span class="material-icons-round align-middle text-4xl mr-2">library_music</span>
        إضافة أغنية جديدة
      </h2>

      <form id="form" class="space-y-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-600">اسم الأغنية</label>
          <input id="title" type="text" 
                 class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-600">الفنان</label>
          <input id="artist" type="text" 
                 class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-600">رابط الصورة</label>
          <input id="image" type="text" 
                 class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all">
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-600">رابط الأغنية</label>
          <input id="link" type="text" 
                 class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all">
        </div>

        <button type="button" onclick="addSong()" 
                class="w-full bg-amber-600 hover:bg-amber-700 text-white font-medium py-3 px-6 rounded-lg 
                       flex items-center justify-center gap-2 transition-all active:scale-95">
          <span class="material-icons-round">add_circle</span>
          إضافة الأغنية
        </button>
      </form>

      <p id="status" class="mt-4 text-center text-sm font-medium text-emerald-600"></p>
    </div>

    <!-- قائمة الأغاني -->
    <div class="glass-effect neumorphic rounded-xl p-6">
      <h3 id="count" class="text-xl font-bold mb-6 text-center text-gray-700 flex items-center justify-center gap-2">
        <span class="material-icons-round">queue_music</span>
        عدد الأغاني: <span id="countNumber">0</span>
      </h3>

      <div id="songsContainer" class="space-y-4"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      onValue,
      remove
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA7rkzwhYa3eHarL9ozmui50_3eiWme-V0",
      authDomain: "golden-vibes-music-hub.firebaseapp.com",
      projectId: "golden-vibes-music-hub",
      storageBucket: "golden-vibes-music-hub.firebasestorage.app",
      messagingSenderId: "1030337936174",
      appId: "1:1030337936174:web:c177b4afb4b26ece4b98bf",
      databaseURL: "https://golden-vibes-music-hub-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const songsRef = ref(db, "songs");

    // إضافة أغنية جديدة
    window.addSong = async function () {
      const title = document.getElementById("title").value;
      const artist = document.getElementById("artist").value;
      const image = document.getElementById("image").value;
      const link = document.getElementById("link").value;

      if (!title || !artist || !image || !link) {
        showAlert("يرجى ملء كل الحقول", "error");
        return;
      }

      const newSong = { 
        title, 
        artist, 
        image, 
        link,
        timestamp: new Date().toISOString()
      };

      try {
        await push(songsRef, newSong);
        showAlert("تمت إضافة الأغنية بنجاح!", "success");
        document.getElementById("form").reset();
      } catch (error) {
        showAlert("حدث خطأ أثناء الإضافة", "error");
      }
    };

    // حذف أغنية
    window.deleteSong = async function (id) {
      if (confirm("هل أنت متأكد من الحذف؟ لا يمكن التراجع عن هذه العملية")) {
        try {
          await remove(ref(db, `songs/${id}`));
          showAlert("تم الحذف بنجاح", "success");
        } catch (error) {
          showAlert("حدث خطأ أثناء الحذف", "error");
        }
      }
    };

    // عرض التنبيهات
    function showAlert(message, type) {
      const statusEl = document.getElementById("status");
      statusEl.textContent = message;
      statusEl.className = `mt-4 text-center text-sm font-medium ${
        type === "success" ? "text-emerald-600" : "text-red-600"
      }`;
      
      setTimeout(() => {
        statusEl.textContent = "";
      }, 3000);
    }

    // عرض الأغاني
    onValue(songsRef, (snapshot) => {
      const container = document.getElementById("songsContainer");
      container.innerHTML = "";
      const songs = snapshot.val() || {};
      const count = Object.keys(songs).length;

      document.getElementById("countNumber").textContent = count;

      Object.entries(songs).forEach(([id, song]) => {
        const songEl = document.createElement("div");
        songEl.className = "song-card glass-effect neumorphic rounded-lg p-4";
        songEl.innerHTML = `
          <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
              <h3 class="font-bold text-lg text-gray-800">${song.title}</h3>
              <p class="text-sm text-gray-600">${song.artist}</p>
              <div class="mt-2 flex items-center gap-2 text-sm">
                <a href="${song.link}" target="_blank" 
                  class="text-amber-600 hover:text-amber-700 flex items-center gap-1">
                  <span class="material-icons-round text-base">link</span>
                  رابط الأغنية
                </a>
              </div>
            </div>
            
            <div class="flex flex-col items-center gap-2">
              <img src="${song.image}" alt="غلاف الأغنية" 
                class="w-16 h-16 rounded-lg object-cover border-2 border-white shadow">
              <button onclick="deleteSong('${id}')" 
                class="text-red-500 hover:text-red-600 flex items-center gap-1 text-sm">
                <span class="material-icons-round">delete</span>
                حذف
              </button>
            </div>
          </div>
          
          <div class="mt-4 hidden" id="player-${id}">
            <audio controls class="w-full rounded-lg">
              <source src="${song.link}" type="audio/mpeg">
              المتصفح لا يدعم تشغيل الصوتيات
            </audio>
          </div>
        `;

        songEl.addEventListener("click", (e) => {
          if (!e.target.closest("button")) {
            const player = songEl.querySelector(`#player-${id}`);
            player.classList.toggle("hidden");
          }
        });

        container.appendChild(songEl);
      });
    });
  </script>
</body>
</html>
